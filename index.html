<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Domain Cover Letter Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* =============================
       THEME VARIABLES
    ============================== */
    :root {
      --bg-color: #ffffff;
      --text-color: #2c3e50;
      --border-color: #e1e5e9;
      --accent-color: #3498db;
      --shadow-color: rgba(0, 0, 0, 0.1);
      --letter-bg: #ffffff;
      --tech-bg: #f8f9fa;
    }

    /* Dark mode overrides */
    [data-theme="dark"] {
      --bg-color: #1e1e1e;
      --text-color: #e0e0e0;
      --border-color: #333333;
      --accent-color: #4aa8ff;
      --shadow-color: rgba(0, 0, 0, 0.6);
      --letter-bg: #252525;
      --tech-bg: #2c2c2c;
    }

    /* =============================
       MAIN STYLES
    ============================== */
    body {
      background: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      transition: background 0.3s ease, color 0.3s ease;
    }

    .cover-letter-generator {
      max-width: 100%;
      margin: 20px auto;
      padding: 0 20px;
    }

    .generator-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-section, .preview-section {
      width: 100%;
      background: var(--letter-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px var(--shadow-color);
      transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .form-section {
      max-width: 600px;
      margin: 0 auto;
    }

    .section-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--border-color);
      color: var(--text-color);
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--text-color);
      font-size: 14px;
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 14px;
      background: var(--bg-color);
      color: var(--text-color);
      transition: border-color 0.3s ease, background 0.3s ease, color 0.3s ease;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    .download-btn {
      background: linear-gradient(135deg, var(--accent-color), #2980b9);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 10px;
    }

    .download-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }

    .preview-box {
      background: var(--letter-bg);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 40px;
      min-height: 500px;
      font-size: 15px;
      line-height: 1.8;
      position: relative;
      max-width: 800px;
      margin: 0 auto;
      transition: background 0.3s ease, border-color 0.3s ease;
    }

    .letter-content {
      font-size: 15px;
      line-height: 1.8;
      color: var(--text-color);
    }

    .letter-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .letter-date {
      text-align: right;
    }

    .letter-to {
      margin-bottom: 25px;
      font-size: 14px;
    }

    .letter-subject {
      margin: 25px 0;
      font-weight: 600;
      font-size: 16px;
    }

    .letter-body p {
      margin-bottom: 15px;
      text-align: justify;
    }

    .tech-details {
      margin: 20px 0;
      padding: 20px;
      background: var(--tech-bg);
      border-left: 4px solid var(--accent-color);
      border-radius: 4px;
      transition: background 0.3s ease, border-color 0.3s ease;
    }

    .tech-details p {
      margin-bottom: 10px;
      font-size: 14px;
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      flex-direction: column;
      gap: 15px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .loading-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(52, 152, 219, 0.2);
      border-top: 4px solid var(--accent-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .form-section {
        max-width: 100%;
      }

      .preview-box {
        padding: 25px;
        font-size: 14px;
        line-height: 1.6;
      }

      .letter-header {
        flex-direction: column;
        gap: 10px;
      }

      .letter-date {
        text-align: left;
      }
    }
  </style>
</head>
<body class="gridLayout onItem onPage">
  <div class="cover-letter-generator">
    <div class="generator-container">
      <div class="form-section">
        <h3 class="section-title">Letter Details</h3>
        <form id="domainForm">
          <div class="form-group">
            <label for="purpose">Purpose</label>
            <select id="purpose" onchange="toggleFields(); generateLetter();">
              <option value="Personal">Personal</option>
              <option value="Business">Business</option>
            </select>
          </div>

          <div class="form-group">
            <label for="domainName">Domain Name</label>
            <input type="text" id="domainName" placeholder="example.com.np" oninput="generateLetter()">
          </div>

          <div class="form-group hidden" id="companyGroup">
            <label for="companyName">Company Name</label>
            <input type="text" id="companyName" placeholder="Your company name" oninput="generateLetter()">
          </div>

          <div class="form-group">
            <label for="primaryNS">Primary Name Server</label>
            <input type="text" id="primaryNS" value="ns1.babal.host" oninput="generateLetter()">
          </div>

          <div class="form-group">
            <label for="secondaryNS">Secondary Name Server</label>
            <input type="text" id="secondaryNS" value="ns2.babal.host" oninput="generateLetter()">
          </div>

          <div class="form-group">
            <label for="userName">Your Name</label>
            <input type="text" id="userName" value="Kushal Shah" oninput="generateLetter()">
          </div>

          <div class="form-group">
            <label for="userAddress">Your Address</label>
            <input type="text" id="userAddress" placeholder="Full address" oninput="generateLetter()">
          </div>

          <button type="button" class="download-btn" onclick="downloadImage()">
            ðŸ“„ Download Cover Letter
          </button>
        </form>
      </div>

      <div class="preview-section">
        <h3 class="section-title">Cover Letter Preview</h3>
        <div id="letterPreview" class="preview-box">
          <div class="letter-content">
            <div class="letter-header">
              <div class="letter-from">
                <div id="userNameDisplay">[Your Name]</div>
                <div id="userAddressDisplay">[Your Address]</div>
              </div>
              <div class="letter-date" id="currentDateDisplay"></div>
            </div>

            <div class="letter-to">
              The Hostmaster,<br>
              Mercantile Communication Pvt. Ltd.<br>
              Durbar Marg, Kathmandu
            </div>

            <div class="letter-subject" id="subjectDisplay">
              Subject: Domain Registration Request
            </div>

            <div class="letter-body" id="letterBody">
              <p>Dear Sir/Madam,</p>
              <p>[Letter content will appear here]</p>
              <div class="tech-details">
                <p><strong>Domain Name:</strong> [domain.com.np]</p>
                <p><strong>Primary Name Server:</strong> [ns1.example.com]</p>
                <p><strong>Secondary Name Server:</strong> [ns2.example.com]</p>
              </div>
              <p>Thank you for your time and consideration.</p>
              <p class="letter-signature">
                Sincerely,<br>
                <span id="signatureName">[Your Name]</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <h3>Generating Cover Letter...</h3>
    <p>Please wait a moment</p>
  </div>

  <script>
    /* =============================
       THEME HANDLING
    ============================== */
    function handleThemeChange() {
      const body = document.body;
      if (body.classList.contains("darkMode")) {
        document.documentElement.setAttribute("data-theme", "dark");
      } else {
        document.documentElement.setAttribute("data-theme", "light");
      }
    }

    // Observe body class changes
    const observer = new MutationObserver(handleThemeChange);
    observer.observe(document.body, {
      attributes: true,
      attributeFilter: ["class"],
    });

    // Run once on page load
    document.addEventListener("DOMContentLoaded", handleThemeChange);

    /* =============================
       FORM FUNCTIONS
    ============================== */
    function toggleFields() {
      const purpose = document.getElementById("purpose").value;
      const companyGroup = document.getElementById("companyGroup");
      if (purpose === "Business") {
        companyGroup.classList.remove("hidden");
      } else {
        companyGroup.classList.add("hidden");
      }
    }

    function generateLetter() {
      const date = new Date();
      const formattedDate = date.toLocaleDateString('en-GB', {
        day: 'numeric', month: 'long', year: 'numeric'
      });

      const purpose = document.getElementById("purpose").value;
      const domainName = document.getElementById("domainName").value || "[domain.com.np]";
      const companyName = document.getElementById("companyName").value || "[Your Company Name]";
      const primaryNS = document.getElementById("primaryNS").value;
      const secondaryNS = document.getElementById("secondaryNS").value;
      const userName = document.getElementById("userName").value || "Kushal Shah";
      const userAddress = document.getElementById("userAddress").value || "[Your Full Address]";

      document.getElementById('userNameDisplay').textContent = userName;
      document.getElementById('userAddressDisplay').textContent = userAddress;
      document.getElementById('currentDateDisplay').textContent = formattedDate;
      document.getElementById('signatureName').textContent = userName;

      const subjectDisplay = document.getElementById('subjectDisplay');
      if (purpose === "Personal") {
        subjectDisplay.textContent = `Subject: Request for Personal Domain Registration - ${domainName}`;
      } else {
        subjectDisplay.textContent = `Subject: Business Domain Registration Request - ${domainName}`;
      }

      const letterBody = document.getElementById('letterBody');
      if (purpose === "Personal") {
        letterBody.innerHTML = `
          <p>Dear Sir/Madam,</p>
          <p>I am writing to formally request the registration of the domain name <strong>${domainName}</strong> for personal use. 
          This domain is intended to represent my personal online presence and digital identity.</p>
          <p>I have provided all necessary personal details below and will be submitting the required documentation.</p>
          <p>The technical specifications for this domain registration are as follows:</p>
          <div class="tech-details">
              <p><strong>Domain Name:</strong> ${domainName}</p>
              <p><strong>Primary Name Server:</strong> ${primaryNS}</p>
              <p><strong>Secondary Name Server:</strong> ${secondaryNS}</p>
          </div>
          <p>Thank you for considering my application. I look forward to your positive response.</p>
          <p class="letter-signature">
            Sincerely,<br>
            <span id="signatureName">${userName}</span>
          </p>
        `;
      } else {
        letterBody.innerHTML = `
          <p>Dear Sir/Madam,</p>
          <p>On behalf of <strong>${companyName}</strong>, I am writing to request the registration of the domain name <strong>${domainName}</strong>. 
          This domain is essential for establishing our company's online presence and digital operations.</p>
          <p>We have enclosed all required documentation to support this application. 
          We believe this domain will significantly contribute to our business growth and customer engagement in the digital marketplace.</p>
          <p>The technical specifications for this domain registration are as follows:</p>
          <div class="tech-details">
              <p><strong>Domain Name:</strong> ${domainName}</p>
              <p><strong>Primary Name Server:</strong> ${primaryNS}</p>
              <p><strong>Secondary Name Server:</strong> ${secondaryNS}</p>
          </div>
          <p>We would be grateful for your prompt attention to this matter.</p>
          <p class="letter-signature">
            Sincerely,<br>
            <span id="signatureName">${userName}</span>
          </p>
        `;
      }
    }

    async function downloadImage() {
      const domainName = document.getElementById("domainName").value;
      if (!domainName) {
        alert("Please enter a domain name before downloading");
        return;
      }

      const loadingOverlay = document.getElementById("loadingOverlay");
      loadingOverlay.classList.add("active");

      try {
        await new Promise(resolve => setTimeout(resolve, 100));
        const letterPreview = document.getElementById("letterPreview");

        const originalStyles = {
          width: letterPreview.style.width,
          maxWidth: letterPreview.style.maxWidth,
          height: letterPreview.style.height,
          position: letterPreview.style.position,
          left: letterPreview.style.left,
          top: letterPreview.style.top,
          zIndex: letterPreview.style.zIndex
        };

        letterPreview.style.width = '800px';
        letterPreview.style.maxWidth = '800px';
        letterPreview.style.height = 'auto';
        letterPreview.style.minHeight = '1000px';
        letterPreview.style.position = 'absolute';
        letterPreview.style.left = '-9999px';
        letterPreview.style.top = '0';
        letterPreview.style.zIndex = '-1';

        await new Promise(resolve => setTimeout(resolve, 200));

        const canvas = await html2canvas(letterPreview, {
          width: 800,
          height: 1000,
          scale: 2,
          backgroundColor: "#ffffff",
          useCORS: true,
          logging: false
        });

        Object.keys(originalStyles).forEach(key => {
          letterPreview.style[key] = originalStyles[key];
        });

        const imgURL = canvas.toDataURL("image/jpeg", 0.95);

        const link = document.createElement("a");
        link.href = imgURL;
        link.download = `${domainName.replace('.com.np', '')}_Cover_Letter.jpg`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

      } catch (error) {
        console.error("Error generating cover letter:", error);
        alert("Error generating document. Please try again.");
      } finally {
        const loadingOverlay = document.getElementById("loadingOverlay");
        loadingOverlay.classList.remove("active");
      }
    }

    /* =============================
       INIT
    ============================== */
    document.addEventListener("DOMContentLoaded", () => {
      toggleFields();
      generateLetter();
    });
  </script>
